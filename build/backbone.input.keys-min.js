!function(e){if("function"==typeof define&&define.amd)define("backbone.input.keys",["jquery","underscore","backbone"],e);else if("object"==typeof module&&module&&"object"==typeof module.exports)module.exports=e;else{var t=window.jQuery||window.Zepto||window.vQuery;e(t,window._,window.Backbone)}}(function(e,t){APP=APP||window.APP||null;var n=null!==APP,i=n&&"undefined"!=typeof APP.View?APP.View:t.View,s=t.View.prototype.delegateEvents,o=t.View.prototype.undelegateEvents,r={backspace:8,tab:9,enter:13,space:32,shift:16,ctrl:17,alt:18,meta:91,caps_lock:20,esc:27,num_lock:144,page_up:33,page_down:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};e.each({options:"alt","return":"enter"},function(e,t){r[t]=r[e]});var u=i.prototype.params||new t.Model;u.set({keys:{}});var d=i.extend({options:{monitor:[],keys:{pause:[]}},params:u,bindKeysOn:["keydown","keyup"],bindKeysScoped:!1,bindTo:null,_keyEventBindings:null,_keys:{},delegateEvents:function(){return s.apply(this,Array.prototype.slice.apply(arguments)),this.delegateKeys(),this},undelegateEvents:function(){return this.undelegateKeys(),o.apply(this,arguments),this},delegateKeys:function(t){var n=this;return this.undelegateKeys(),this.bindTo||(this.bindTo=this.bindKeysScoped||"undefined"==typeof $?this.$el:$(document)),e.each(this.bindKeysOn,function(t){n.bindTo.on(t+".delegateKeys"+n.cid,e.bind(n.triggerKey,n))}),t=t||this.keys,t&&(this._keys=h(t),e.each(t,function(e,t){this.keyOn(t,e)},this)),this},undelegateKeys:function(){var t=this;return this._keyEventBindings={},this.bindTo&&e.each(this.bindKeysOn,function(e){t.bindTo.off(e+".delegateKeys"+t.cid)}),this},keyName:function(e){var t;for(t in r)if(r[t]===e)return t;return String.fromCharCode(e)},triggerKey:function(t){var n;return e.isObject(t)?n=t.which:e.isString(t)?n=a(t):e.isNumber(t)&&(n=t),e(this._keyEventBindings[n]).each(function(n){var i=!0;n.modifiers&&(i=e(n.modifiers).all(function(e){return t[e+"Key"]===!0})),i&&n.method(t,n.key)}),this},keyOn:function(t,n){t=t.split(" ");{if(!(t.length>1)){t=t.pop().toLowerCase();var i=t.split("+");t=i.shift();var s=this.params.get("keys");s[t]=!0,this.params.set({keys:s});var o=a(t);return this._keyEventBindings.hasOwnProperty(o)||(this._keyEventBindings[o]=[]),e.isFunction(n)||(n=this[n]),this._keyEventBindings[o].push({key:t,modifiers:i||!1,method:e.bind(n,this)}),this}for(var r=t.length;r--;)this.keyOn(t[r],n)}},keyOff:function(t,n){if(n=n||!1,null===t)return this._keyEventBindings={},this;var i=this.params.get("keys");delete i[t],this.params.set({keys:i});var s=a(t);return e.isFunction(n)||(n=this[n]),n?(this._keyEventBindings[s]=e.filter(this._keyEventBindings[s],function(e){return e.method===n}),this):(this._keyEventBindings[s]=[],this)},remove:function(){return this.undelegateKeys(),i.prototype.remove.apply(this,arguments)}}),a=function(e){return 1===e.length?e.toUpperCase().charCodeAt(0):r[e]},h=function(t){var n={};return e.each(t,function(e,t){t=t.toLowerCase(),t=t.split(" "),n[e]=t},this),n};return t.Input=t.Input||{},t.Input.Keys=d,n&&(APP.Input=APP.Input||{},APP.Input.Keys=d),"object"==typeof window&&"object"==typeof window.document&&(window.Backbone=t,n&&(window.APP=APP)),d});