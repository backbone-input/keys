/*!
 * Backbone.keys.js v0.2.0
 * Copyright 2012, Raymond Julin (@nervetattoo)
 * backbone.keys.js may be freely distributed under the MIT license.
 */(function(e){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone","jquery"],e):e(_,Backbone,$)})(function(e,t,n){"use strict";var i=t.View.prototype.delegateEvents,s=t.View.prototype.undelegateEvents,r=function(e){return 1===e.length?e.toUpperCase().charCodeAt(0):o[e]},o={backspace:8,tab:9,enter:13,space:32,shift:16,ctrl:17,alt:18,meta:91,caps_lock:20,esc:27,num_lock:144,page_up:33,page_down:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};return e.each({options:"alt","return":"enter"},function(e,t){o[t]=o[e]}),t.View=t.View.extend({bindKeysOn:"keydown",bindKeysScoped:!1,bindTo:null,_keyEventBindings:null,delegateEvents:function(){return i.apply(this,Array.prototype.slice.apply(arguments)),this.delegateKeys(),this},undelegateEvents:function(){return this.undelegateKeys(),s.apply(this,arguments),this},delegateKeys:function(t){return this.undelegateKeys(),this.bindTo||(this.bindTo=this.bindKeysScoped||n===void 0?this.$el:n(document)),this.bindTo.on(this.bindKeysOn+".delegateKeys"+this.cid,e.bind(this.triggerKey,this)),t=t||this.keys,t&&e.each(t,function(e,t){this.keyOn(t,e)},this),this},undelegateKeys:function(){return this._keyEventBindings={},this.bindTo&&this.bindTo.off(this.bindKeysOn+".delegateKeys"+this.cid),this},keyName:function(e){var t;for(t in o)if(o[t]===e)return t;return String.fromCharCode(e)},triggerKey:function(t){var n;return e.isObject(t)?n=t.which:e.isString(t)?n=r(t):e.isNumber(t)&&(n=t),e(this._keyEventBindings[n]).each(function(n){var i=!0;n.modifiers&&(i=e(n.modifiers).all(function(e){return t[e+"Key"]===!0})),i&&n.method(t,n.key)}),this},keyOn:function(t,n){t=t.split(" ");{if(!(t.length>1)){t=t.pop().toLowerCase();var i=t.split("+");t=i.shift();var s=r(t);return this._keyEventBindings.hasOwnProperty(s)||(this._keyEventBindings[s]=[]),e.isFunction(n)||(n=this[n]),this._keyEventBindings[s].push({key:t,modifiers:i||!1,method:e.bind(n,this)}),this}for(var o=t.length;o--;)this.keyOn(t[o],n)}},keyOff:function(t,n){if(n=n||!1,null===t)return this._keyEventBindings={},this;var i=r(t);return e.isFunction(n)||(n=this[n]),n?(this._keyEventBindings[i]=e.filter(this._keyEventBindings[i],function(e){return e.method===n}),this):(this._keyEventBindings[i]=[],this)}}),t});